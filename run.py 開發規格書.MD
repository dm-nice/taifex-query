# run.py é–‹ç™¼è¦æ ¼æ›¸

**ç¨‹å¼åç¨±**: run.py  
**åŠŸèƒ½**: æ¨¡çµ„çµ±ä¸€åŸ·è¡Œç¨‹å¼  
**ç‰ˆæœ¬**: 2.0ï¼ˆæ··åˆæ¨¡å¼ï¼‰  
**æœ€å¾Œæ›´æ–°**: 2025-12-04

---

## ğŸ“‹ ç›®éŒ„

1. [ç¨‹å¼æ¦‚è¿°](#ç¨‹å¼æ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
3. [æ¶æ§‹è¨­è¨ˆ](#æ¶æ§‹è¨­è¨ˆ)
4. [å‡½å¼è¦æ ¼](#å‡½å¼è¦æ ¼)
5. [åŸ·è¡Œæµç¨‹](#åŸ·è¡Œæµç¨‹)
6. [è¼¸å‡ºè¦æ ¼](#è¼¸å‡ºè¦æ ¼)
7. [éŒ¯èª¤è™•ç†](#éŒ¯èª¤è™•ç†)
8. [ä½¿ç”¨ç¯„ä¾‹](#ä½¿ç”¨ç¯„ä¾‹)
9. [ç¶­è­·æŒ‡å—](#ç¶­è­·æŒ‡å—)

---

## ç¨‹å¼æ¦‚è¿°

### ç”¨é€”

`run.py` æ˜¯æ•´å€‹ç³»çµ±çš„**ä¸»æ§ç¨‹å¼**ï¼Œè² è²¬ï¼š
- è‡ªå‹•è¼‰å…¥ä¸¦åŸ·è¡Œæ‰€æœ‰ fetcher æ¨¡çµ„
- çµ±ä¸€è™•ç†æ¨¡çµ„å›å‚³çµæœ
- é›†ä¸­è¼¸å‡º JSON æª”æ¡ˆå’Œæ—¥èªŒ
- æä¾›å‹å–„çš„ä¸­æ–‡ä»‹é¢çµ¦ä½¿ç”¨è€…

### è¨­è¨ˆç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä½¿ç”¨è€…ä»‹é¢    â”‚ â† å…¨ä¸­æ–‡é¡¯ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     run.py      â”‚ â† æ··åˆæ¨¡å¼ï¼ˆè‹±æ–‡ key + ä¸­æ–‡é¡¯ç¤ºï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  fetcher æ¨¡çµ„   â”‚ â† å›å‚³è‹±æ–‡ key
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ··åˆæ¨¡å¼**:
- æ¨¡çµ„é–“é€šè¨Šï¼šä½¿ç”¨è‹±æ–‡ key
- ä½¿ç”¨è€…ä»‹é¢ï¼šé¡¯ç¤ºä¸­æ–‡è¨Šæ¯

### ä¸æ‡‰ä¿®æ”¹çš„åŸå‰‡

âš ï¸ **ä¸€èˆ¬é–‹ç™¼è€…ä¸éœ€è¦ä¿®æ”¹ `run.py`**  
- fetcher æ¨¡çµ„é–‹ç™¼è€…ï¼šåªéœ€ç¢ºä¿å›å‚³æ ¼å¼æ­£ç¢º
- ç³»çµ±ç¶­è­·è€…ï¼šæ‰éœ€è¦äº†è§£ `run.py` å…§éƒ¨

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ¨¡çµ„è‡ªå‹•è¼‰å…¥

```python
# è‡ªå‹•æƒæ dev/ æˆ– modules/ è³‡æ–™å¤¾
# æ‰¾åˆ°æ‰€æœ‰ xxx_fetcher.py æª”æ¡ˆ
# å‹•æ…‹è¼‰å…¥ä¸¦åŸ·è¡Œ
```

### 2. çµ±ä¸€åŸ·è¡Œä»‹é¢

```bash
# æ”¯æ´å¤šç¨®åŸ·è¡Œæ¨¡å¼
python run.py                              # ä»Šå¤©æ—¥æœŸ
python run.py 2025-12-01                   # æŒ‡å®šæ—¥æœŸ
python run.py 2025-12-01 dev               # é©—æ”¶æ¨¡å¼
python run.py 2025-12-01 dev --module f01  # å–®ä¸€æ¨¡çµ„
```

### 3. çµæœé›†ä¸­è¼¸å‡º

æ‰€æœ‰çµæœçµ±ä¸€è¼¸å‡ºåˆ° `C:\Taifex\data\`:
- JSON æª”æ¡ˆï¼š`YYYY-MM-DD_æ¨¡çµ„åç¨±.json`
- æ—¥èªŒæª”æ¡ˆï¼š`YYYY-MM-DD_run.log`

### 4. å‹å–„çš„ä¸­æ–‡ä»‹é¢

```
======================================================================
  ğŸ“… æŸ¥è©¢æ—¥æœŸ: 2025-12-01
  â° åŸ·è¡Œæ™‚é–“: 2025-12-04 10:30:00
  ğŸ”§ åŸ·è¡Œæ¨¡å¼: é©—æ”¶æ¨¡å¼
======================================================================

ğŸ“¦ æ‰¾åˆ° 3 å€‹æ¨¡çµ„

[1/3] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åŸ·è¡Œæ¨¡çµ„: dev.f01_fetcher_dev
ğŸ’¾ æª”æ¡ˆ: 2025-12-04_f01_fetcher_dev_dev.json
  âœ… ç‹€æ…‹: æˆåŠŸ
  ğŸ“Š å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£ï¼ˆå¤šæ–¹ 18,268ï¼Œç©ºæ–¹ 47,300ï¼‰
     â€¢ å¤šæ–¹å£æ•¸: 18,268
     â€¢ ç©ºæ–¹å£æ•¸: 47,300
     â€¢ æ·¨é¡: -29,032
```

---

## æ¶æ§‹è¨­è¨ˆ

### ç¨‹å¼çµæ§‹

```python
# ===== è¨­å®š =====
BASE_DIR = Path(r"C:\Taifex\data")
STATUS_ICONS = {...}

# ===== æ ¸å¿ƒå‡½å¼ =====
def setup_logger()          # è¨­å®šæ—¥èªŒ
def get_module_list()       # å–å¾—æ¨¡çµ„åˆ—è¡¨
def validate_result_format() # é©—è­‰å›å‚³æ ¼å¼
def save_result()           # å„²å­˜çµæœ
def execute_module()        # åŸ·è¡Œæ¨¡çµ„
def print_summary()         # é¡¯ç¤ºæ‘˜è¦
def run()                   # ä¸»åŸ·è¡Œå‡½å¼
def validate_date()         # é©—è­‰æ—¥æœŸ
def print_usage()           # é¡¯ç¤ºèªªæ˜
def main()                  # ç¨‹å¼é€²å…¥é»
```

### è³‡æ–™æµå‘

```
å‘½ä»¤åˆ—åƒæ•¸
    â†“
è§£æåƒæ•¸ï¼ˆæ—¥æœŸã€æ¨¡å¼ã€æŒ‡å®šæ¨¡çµ„ï¼‰
    â†“
å–å¾—æ¨¡çµ„åˆ—è¡¨ï¼ˆget_module_listï¼‰
    â†“
é€ä¸€åŸ·è¡Œæ¨¡çµ„ï¼ˆexecute_moduleï¼‰
    â†“
    â”œâ†’ è¼‰å…¥æ¨¡çµ„ï¼ˆimportlibï¼‰
    â”œâ†’ å‘¼å« fetch()
    â”œâ†’ é©—è­‰æ ¼å¼ï¼ˆvalidate_result_formatï¼‰
    â””â†’ å„²å­˜çµæœï¼ˆsave_resultï¼‰
    â†“
é¡¯ç¤ºçµ±è¨ˆå ±å‘Š
```

---

## å‡½å¼è¦æ ¼

### setup_logger(log_file: Path) -> logging.Logger

**åŠŸèƒ½**: è¨­å®šæ—¥èªŒè¨˜éŒ„å™¨

**åƒæ•¸**:
- `log_file`: æ—¥èªŒæª”æ¡ˆè·¯å¾‘

**å›å‚³**: é…ç½®å¥½çš„ logger ç‰©ä»¶

**ç‰¹é»**:
- æª”æ¡ˆ handler: è¨˜éŒ„è©³ç´°è³‡è¨Šï¼ˆDEBUG å±¤ç´šï¼‰
- çµ‚ç«¯æ©Ÿ handler: ç°¡æ½”è¼¸å‡ºï¼ˆINFO å±¤ç´šï¼‰
- è‡ªå‹•è™•ç† UTF-8 ç·¨ç¢¼

**ç¯„ä¾‹**:
```python
log_file = BASE_DIR / "2025-12-04_run.log"
logger = setup_logger(log_file)
logger.info("é–‹å§‹åŸ·è¡Œ")
```

---

### get_module_list(folder: str, only_module: Optional[str]) -> List[str]

**åŠŸèƒ½**: å–å¾—æ¨¡çµ„åˆ—è¡¨

**åƒæ•¸**:
- `folder`: æ¨¡çµ„è³‡æ–™å¤¾ï¼ˆ"dev" æˆ– "modules"ï¼‰
- `only_module`: åƒ…åŸ·è¡Œç‰¹å®šæ¨¡çµ„ï¼ˆå¯é¸ï¼‰

**å›å‚³**: æ’åºå¾Œçš„æ¨¡çµ„åç¨±åˆ—è¡¨

**é‚è¼¯**:
```python
# 1. æƒæè³‡æ–™å¤¾ä¸­çš„ .py æª”æ¡ˆ
# 2. æ’é™¤ _ é–‹é ­çš„æª”æ¡ˆï¼ˆä¾‹å¦‚ __init__.pyï¼‰
# 3. çµ„æˆå®Œæ•´æ¨¡çµ„è·¯å¾‘ï¼ˆä¾‹å¦‚ "dev.f01_fetcher"ï¼‰
# 4. å¦‚æœæŒ‡å®šç‰¹å®šæ¨¡çµ„ï¼Œé€²è¡Œéæ¿¾
# 5. æ’åºå¾Œå›å‚³
```

**ç¯„ä¾‹**:
```python
# å–å¾— dev/ ä¸‹æ‰€æœ‰æ¨¡çµ„
modules = get_module_list("dev")
# ['dev.f01_fetcher_dev', 'dev.f02_fetcher_dev']

# åªå–å¾—ç‰¹å®šæ¨¡çµ„
modules = get_module_list("dev", "f01_fetcher_dev")
# ['dev.f01_fetcher_dev']
```

---

### validate_result_format(result: Dict, module_name: str, query_date: str) -> Tuple[Dict, str]

**åŠŸèƒ½**: é©—è­‰ä¸¦æ­£è¦åŒ–æ¨¡çµ„è¿”å›çµæœ

**åƒæ•¸**:
- `result`: æ¨¡çµ„å›å‚³çš„çµæœ
- `module_name`: æ¨¡çµ„åç¨±
- `query_date`: æŸ¥è©¢æ—¥æœŸ

**å›å‚³**: (æ­£è¦åŒ–å¾Œçš„çµæœ, ç‹€æ…‹ç¢¼)

**é©—è­‰é …ç›®**:
1. âœ… æ˜¯å¦ç‚º dict é¡å‹
2. âœ… æ˜¯å¦åŒ…å« "status" æ¬„ä½
3. âœ… è£œå……ç¼ºå°‘çš„ "module" å’Œ "date" æ¬„ä½

**è™•ç†é‚è¼¯**:
```python
# å¦‚æœæ ¼å¼éŒ¯èª¤
if not isinstance(result, dict):
    return (invalid_result, "invalid")

# å¦‚æœç¼ºå°‘ status
if "status" not in result:
    return (invalid_result, "invalid")

# è£œå……ç¼ºå°‘çš„æ¬„ä½
if "module" not in result:
    result["module"] = module_short

return (result, status)
```

---

### execute_module(module_name: str, query_date: str, logger: logging.Logger) -> Tuple[Dict, str]

**åŠŸèƒ½**: åŸ·è¡Œå–®ä¸€æ¨¡çµ„

**åƒæ•¸**:
- `module_name`: æ¨¡çµ„å®Œæ•´åç¨±ï¼ˆä¾‹å¦‚ "dev.f01_fetcher_dev"ï¼‰
- `query_date`: æŸ¥è©¢æ—¥æœŸ
- `logger`: æ—¥èªŒè¨˜éŒ„å™¨

**å›å‚³**: (åŸ·è¡Œçµæœ, ç‹€æ…‹ç¢¼)

**åŸ·è¡Œæµç¨‹**:
```python
try:
    # 1. å‹•æ…‹è¼‰å…¥æ¨¡çµ„
    mod = importlib.import_module(module_name)
    
    # 2. æª¢æŸ¥æ˜¯å¦æœ‰ fetch å‡½å¼
    if not hasattr(mod, 'fetch'):
        return (error_result, "error")
    
    # 3. åŸ·è¡Œ fetch å‡½å¼
    result = mod.fetch(query_date)
    
    # 4. é©—è­‰ä¸¦æ­£è¦åŒ–çµæœ
    validated_result, status = validate_result_format(result, module_name, query_date)
    
    return (validated_result, status)
    
except ImportError:
    return (error_result, "error")
except Exception:
    return (error_result, "error")
```

---

### print_summary(result: Dict, status: str, logger: logging.Logger)

**åŠŸèƒ½**: é¡¯ç¤ºåŸ·è¡Œæ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

**åƒæ•¸**:
- `result`: åŸ·è¡Œçµæœ
- `status`: ç‹€æ…‹ç¢¼
- `logger`: æ—¥èªŒè¨˜éŒ„å™¨

**é¡¯ç¤ºé‚è¼¯**:
```python
# 1. é¡¯ç¤ºç‹€æ…‹ï¼ˆä¸­æ–‡ï¼‰
logger.info(f"  {icon} ç‹€æ…‹: {status_zh}")

# 2. é¡¯ç¤ºæ‘˜è¦æˆ–éŒ¯èª¤è¨Šæ¯
if "summary" in result:
    logger.info(f"  ğŸ“Š {result['summary']}")
elif "error" in result:
    logger.info(f"  ğŸ’¬ {result['error']}")

# 3. é¡¯ç¤ºè³‡æ–™å…§å®¹ï¼ˆå°‡è‹±æ–‡ key è½‰ç‚ºä¸­æ–‡ï¼‰
if status == "success" and "data" in result:
    for key, value in result["data"].items():
        key_zh = KEY_MAPPING.get(key, key)
        logger.info(f"     â€¢ {key_zh}: {value:,}")
```

**è‹±æ–‡ key è½‰ä¸­æ–‡å°ç…§**:
```python
KEY_MAPPING = {
    "long_position": "å¤šæ–¹å£æ•¸",
    "short_position": "ç©ºæ–¹å£æ•¸",
    "net_position": "æ·¨é¡"
}
```

---

### run(query_date: str, dev_mode: bool, only_module: Optional[str])

**åŠŸèƒ½**: ä¸»åŸ·è¡Œå‡½å¼

**åƒæ•¸**:
- `query_date`: æŸ¥è©¢æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- `dev_mode`: æ˜¯å¦ç‚ºé©—æ”¶æ¨¡å¼
- `only_module`: åƒ…åŸ·è¡Œç‰¹å®šæ¨¡çµ„ï¼ˆå¯é¸ï¼‰

**åŸ·è¡Œæµç¨‹**:

```
1. å»ºç«‹è¼¸å‡ºç›®éŒ„
   â†“
2. è¨­å®šåƒæ•¸ï¼ˆfolder, mode, exec_day, log_fileï¼‰
   â†“
3. è¨­å®šæ—¥èªŒè¨˜éŒ„å™¨
   â†“
4. é¡¯ç¤ºæ¨™é¡Œ
   â†“
5. å–å¾—æ¨¡çµ„åˆ—è¡¨
   â†“
6. é€ä¸€åŸ·è¡Œæ¨¡çµ„
   â”‚  â”œâ†’ åŸ·è¡Œæ¨¡çµ„ï¼ˆexecute_moduleï¼‰
   â”‚  â”œâ†’ å„²å­˜çµæœï¼ˆsave_resultï¼‰
   â”‚  â””â†’ é¡¯ç¤ºæ‘˜è¦ï¼ˆprint_summaryï¼‰
   â†“
7. é¡¯ç¤ºçµ±è¨ˆå ±å‘Š
```

---

## åŸ·è¡Œæµç¨‹

### å®Œæ•´æµç¨‹åœ–

```
ä½¿ç”¨è€…åŸ·è¡Œå‘½ä»¤
    â†“
main() è§£æåƒæ•¸
    â”œâ”€ æ—¥æœŸï¼ˆquery_dateï¼‰
    â”œâ”€ æ¨¡å¼ï¼ˆdev_modeï¼‰
    â””â”€ æ¨¡çµ„ï¼ˆonly_moduleï¼‰
    â†“
é©—è­‰æ—¥æœŸæ ¼å¼
    â†“
å‘¼å« run()
    â†“
å–å¾—æ¨¡çµ„åˆ—è¡¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€ä¸€åŸ·è¡Œæ¨¡çµ„ï¼ˆè¿´åœˆï¼‰  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. execute_module   â”‚
â”‚     â”œâ”€ importlib     â”‚
â”‚     â”œâ”€ å‘¼å« fetch()  â”‚
â”‚     â””â”€ validate      â”‚
â”‚  2. save_result      â”‚
â”‚  3. print_summary    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
é¡¯ç¤ºçµ±è¨ˆå ±å‘Š
    â†“
çµæŸ
```

### æ¨¡çµ„åŸ·è¡Œç´°ç¯€

æ¯å€‹æ¨¡çµ„çš„åŸ·è¡Œéç¨‹ï¼š

```python
for idx, module_name in enumerate(modules, 1):
    # 1. é¡¯ç¤ºé€²åº¦
    logger.info(f"[{idx}/{len(modules)}] â”€â”€â”€â”€â”€â”€â”€")
    
    # 2. åŸ·è¡Œæ¨¡çµ„
    result, status = execute_module(module_name, query_date, logger)
    
    # 3. æ›´æ–°çµ±è¨ˆ
    stats[status] += 1
    
    # 4. å„²å­˜çµæœ
    data_file = save_result(result, module_name, exec_day, dev_mode)
    logger.info(f"ğŸ’¾ æª”æ¡ˆ: {data_file.name}")
    
    # 5. é¡¯ç¤ºæ‘˜è¦
    print_summary(result, status, logger)
```

---

## è¼¸å‡ºè¦æ ¼

### JSON æª”æ¡ˆ

**æª”åæ ¼å¼**:
- æ­£å¼æ¨¡å¼: `YYYY-MM-DD_æ¨¡çµ„åç¨±.json`
- é©—æ”¶æ¨¡å¼: `YYYY-MM-DD_æ¨¡çµ„åç¨±_dev.json`

**å…§å®¹ç¯„ä¾‹**:
```json
{
  "module": "f01",
  "date": "2025-12-01",
  "status": "success",
  "summary": "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£ï¼ˆå¤šæ–¹ 18,268ï¼Œç©ºæ–¹ 47,300ï¼‰",
  "data": {
    "long_position": 18268,
    "short_position": 47300,
    "net_position": -29032
  },
  "source": "TAIFEX"
}
```

### æ—¥èªŒæª”æ¡ˆ

**æª”åæ ¼å¼**:
- æ­£å¼æ¨¡å¼: `YYYY-MM-DD_run.log`
- é©—æ”¶æ¨¡å¼: `YYYY-MM-DD_run_dev.log`

**å…§å®¹ç¯„ä¾‹**:
```
2025-12-04 10:30:00 [INFO] ======================================
2025-12-04 10:30:00 [INFO]   æŸ¥è©¢æ—¥æœŸ: 2025-12-01
2025-12-04 10:30:00 [INFO]   åŸ·è¡Œæ™‚é–“: 2025-12-04 10:30:00
2025-12-04 10:30:00 [INFO]   åŸ·è¡Œæ¨¡å¼: é©—æ”¶æ¨¡å¼
2025-12-04 10:30:00 [INFO] ======================================
2025-12-04 10:30:01 [INFO] åŸ·è¡Œæ¨¡çµ„: dev.f01_fetcher_dev
2025-12-04 10:30:02 [INFO] ğŸ’¾ æª”æ¡ˆ: 2025-12-04_f01_fetcher_dev_dev.json
2025-12-04 10:30:02 [INFO]   âœ… ç‹€æ…‹: æˆåŠŸ
```

### çµ‚ç«¯æ©Ÿè¼¸å‡º

```
======================================================================
  ğŸ“… æŸ¥è©¢æ—¥æœŸ: 2025-12-01
  â° åŸ·è¡Œæ™‚é–“: 2025-12-04 10:30:00
  ğŸ”§ åŸ·è¡Œæ¨¡å¼: é©—æ”¶æ¨¡å¼
======================================================================

ğŸ“¦ æ‰¾åˆ° 3 å€‹æ¨¡çµ„

[1/3] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
åŸ·è¡Œæ¨¡çµ„: dev.f01_fetcher_dev
ğŸ’¾ æª”æ¡ˆ: 2025-12-04_f01_fetcher_dev_dev.json
  âœ… ç‹€æ…‹: æˆåŠŸ
  ğŸ“Š å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£ï¼ˆå¤šæ–¹ 18,268ï¼Œç©ºæ–¹ 47,300ï¼‰
     â€¢ å¤šæ–¹å£æ•¸: 18,268
     â€¢ ç©ºæ–¹å£æ•¸: 47,300
     â€¢ æ·¨é¡: -29,032

======================================================================
  ğŸ“Š åŸ·è¡Œçµ±è¨ˆ
======================================================================
  ç¸½æ•¸: 3
  âœ… æˆåŠŸ: 2 (66.7%)
  âš ï¸  å¤±æ•—: 1 (33.3%)
  âŒ éŒ¯èª¤: 0 (0.0%)
  â›” ç„¡æ•ˆ: 0 (0.0%)
======================================================================
ğŸ“ è©³ç´°æ—¥èªŒ: C:\Taifex\data\2025-12-04_run_dev.log
======================================================================
```

---

## éŒ¯èª¤è™•ç†

### æ¨¡çµ„è¼‰å…¥éŒ¯èª¤

```python
except ImportError as e:
    logger.error(f"æ¨¡çµ„è¼‰å…¥å¤±æ•—: {e}")
    error_result = {
        "module": module_short,
        "date": query_date,
        "status": "error",
        "error": f"ç„¡æ³•è¼‰å…¥æ¨¡çµ„: {str(e)}"
    }
```

### æ¨¡çµ„åŸ·è¡ŒéŒ¯èª¤

```python
except Exception as e:
    logger.error(f"åŸ·è¡Œç•°å¸¸: {str(e)}")
    logger.debug(traceback.format_exc())  # è¨˜éŒ„å®Œæ•´ traceback
    error_result = {
        "module": module_short,
        "date": query_date,
        "status": "error",
        "error": f"åŸ·è¡Œå¤±æ•—: {str(e)}"
    }
```

### å„²å­˜çµæœéŒ¯èª¤

```python
try:
    data_file = save_result(result, module_name, exec_day, dev_mode)
except Exception as e:
    logger.error(f"âŒ å„²å­˜å¤±æ•—: {e}")
    stats["error"] += 1
```

### ä½¿ç”¨è€…ä¸­æ–·

```python
try:
    run(query_date, dev_mode, only_module)
except KeyboardInterrupt:
    print("\n\nâš ï¸  åŸ·è¡Œè¢«ä½¿ç”¨è€…ä¸­æ–· (Ctrl+C)")
    sys.exit(130)  # æ¨™æº– SIGINT é€€å‡ºç¢¼
```

---

## ä½¿ç”¨ç¯„ä¾‹

### åŸºæœ¬ä½¿ç”¨

```bash
# åŸ·è¡Œä»Šå¤©çš„æ—¥æœŸ
python run.py

# åŸ·è¡ŒæŒ‡å®šæ—¥æœŸ
python run.py 2025-12-01

# é¡¯ç¤ºèªªæ˜
python run.py --help
```

### é©—æ”¶æ¨¡å¼

```bash
# åŸ·è¡Œ dev/ è³‡æ–™å¤¾çš„æ‰€æœ‰æ¨¡çµ„
python run.py 2025-12-01 dev

# åªåŸ·è¡Œç‰¹å®šæ¨¡çµ„
python run.py 2025-12-01 dev --module f01_fetcher_dev
```

### æ­£å¼æ¨¡å¼

```bash
# åŸ·è¡Œ modules/ è³‡æ–™å¤¾çš„æ‰€æœ‰æ¨¡çµ„
python run.py 2025-12-01

# åªåŸ·è¡Œç‰¹å®šæ¨¡çµ„
python run.py 2025-12-01 --module f01_fetcher
```

### æª¢æŸ¥çµæœ

```bash
# æŸ¥çœ‹ JSON è¼¸å‡º
type data\2025-12-04_f01_fetcher.json

# æŸ¥çœ‹æ—¥èªŒ
type data\2025-12-04_run.log

# åˆ—å‡ºæ‰€æœ‰è¼¸å‡º
dir data\2025-12-04*
```

---

## ç¶­è­·æŒ‡å—

### ä½•æ™‚éœ€è¦ä¿®æ”¹ run.py

é€šå¸¸**ä¸éœ€è¦ä¿®æ”¹**ï¼Œé™¤éï¼š

1. **æ–°å¢åŠŸèƒ½**
   - å¢åŠ æ–°çš„å‘½ä»¤åˆ—åƒæ•¸
   - å¢åŠ æ–°çš„è¼¸å‡ºæ ¼å¼
   - å¢åŠ æ–°çš„é©—è­‰è¦å‰‡

2. **ä¿®æ”¹è¦ç¯„**
   - æ”¹è®Šæ¨¡çµ„å›å‚³æ ¼å¼
   - æ”¹è®Šæª”æ¡ˆå‘½åè¦å‰‡
   - æ”¹è®Šè¼¸å‡ºç›®éŒ„

3. **æ•ˆèƒ½å„ªåŒ–**
   - åŠ å…¥å¹³è¡Œè™•ç†
   - å„ªåŒ–è¼‰å…¥é€Ÿåº¦
   - å¢åŠ å¿«å–æ©Ÿåˆ¶

### ä¿®æ”¹æ™‚çš„æ³¨æ„äº‹é …

âš ï¸ **é‡è¦**ï¼šä¿®æ”¹å‰å…ˆå‚™ä»½ï¼

```bash
# å‚™ä»½ç•¶å‰ç‰ˆæœ¬
copy run.py run_backup_YYYYMMDD.py
```

âœ… **æ¸¬è©¦æµç¨‹**ï¼š
1. åœ¨ `dev/` æ¨¡å¼æ¸¬è©¦
2. ç¢ºèªæ‰€æœ‰æ¨¡çµ„éƒ½èƒ½æ­£å¸¸åŸ·è¡Œ
3. æª¢æŸ¥ JSON å’Œæ—¥èªŒè¼¸å‡º
4. å†åˆ‡æ›åˆ°æ­£å¼æ¨¡å¼

### å¸¸è¦‹ç¶­è­·ä»»å‹™

#### 1. å¢åŠ æ–°çš„ key è½‰æ›å°ç…§

å¦‚æœæœ‰æ–°çš„ data key éœ€è¦é¡¯ç¤ºä¸­æ–‡ï¼š

```python
# åœ¨ print_summary() å‡½å¼ä¸­
key_zh = {
    "long_position": "å¤šæ–¹å£æ•¸",
    "short_position": "ç©ºæ–¹å£æ•¸",
    "net_position": "æ·¨é¡",
    "new_field": "æ–°æ¬„ä½åç¨±"  # â† å¢åŠ é€™è£¡
}.get(key, key)
```

#### 2. ä¿®æ”¹è¼¸å‡ºç›®éŒ„

```python
# åœ¨æª”æ¡ˆé–‹é ­
BASE_DIR = Path(r"C:\Taifex\data")  # â† ä¿®æ”¹é€™è£¡
```

#### 3. èª¿æ•´æ—¥èªŒæ ¼å¼

```python
# åœ¨ setup_logger() å‡½å¼ä¸­
LOG_FORMAT = "%(asctime)s [%(levelname)s] %(message)s"  # â† ä¿®æ”¹é€™è£¡
```

---

## æŠ€è¡“ç´°ç¯€

### å‹•æ…‹è¼‰å…¥æ©Ÿåˆ¶

```python
# ä½¿ç”¨ importlib å‹•æ…‹è¼‰å…¥æ¨¡çµ„
import importlib

module_name = "dev.f01_fetcher_dev"
mod = importlib.import_module(module_name)

# æª¢æŸ¥æ˜¯å¦æœ‰ fetch å‡½å¼
if hasattr(mod, 'fetch'):
    result = mod.fetch(date)
```

### è·¯å¾‘è™•ç†

```python
# ä½¿ç”¨ pathlib è™•ç†è·¯å¾‘ï¼ˆè·¨å¹³å°ï¼‰
from pathlib import Path

BASE_DIR = Path(r"C:\Taifex\data")
log_file = BASE_DIR / f"{exec_day}_run.log"
data_file = BASE_DIR / f"{exec_day}_{module}.json"
```

### æ—¥èªŒé›™è¼¸å‡º

```python
# åŒæ™‚è¼¸å‡ºåˆ°æª”æ¡ˆå’Œçµ‚ç«¯æ©Ÿ
file_handler = logging.FileHandler(log_file, encoding='utf-8')
console_handler = logging.StreamHandler(sys.stdout)

logger.addHandler(file_handler)
logger.addHandler(console_handler)
```

---

## ç‰ˆæœ¬æ­·å²

### v2.0ï¼ˆæ··åˆæ¨¡å¼ï¼‰- 2025-12-04
- âœ¨ æ¡ç”¨æ··åˆæ¨¡å¼è¨­è¨ˆï¼ˆè‹±æ–‡ key + ä¸­æ–‡é¡¯ç¤ºï¼‰
- âœ¨ æ”¹é€²çµ‚ç«¯æ©Ÿè¼¸å‡ºï¼ˆåŠ å…¥è¡¨æƒ…ç¬¦è™Ÿå’Œé€²åº¦ï¼‰
- âœ¨ å¢åŠ è³‡æ–™æ¬„ä½è‡ªå‹•è½‰æ›ï¼ˆè‹±æ–‡ â†’ ä¸­æ–‡é¡¯ç¤ºï¼‰
- ğŸ› ä¿®æ­£ Git åŒæ­¥å•é¡Œ

### v1.0ï¼ˆåˆç‰ˆï¼‰
- åŸºæœ¬çš„æ¨¡çµ„åŸ·è¡ŒåŠŸèƒ½
- ä½¿ç”¨ä¸­æ–‡ key

---

## ç›¸é—œæ–‡ä»¶

- [å…±åŒé–‹ç™¼è¦ç¯„æ›¸](å…±åŒé–‹ç™¼è¦ç¯„æ›¸_V1.md) - æ‰€æœ‰ fetcher æ¨¡çµ„çš„é€šç”¨è¦ç¯„
- [f01_fetcher é–‹ç™¼è¦ç¯„æ›¸](f01_package/f01_fetcher_é–‹ç™¼è¦ç¯„æ›¸.md) - f01 æ¨¡çµ„å°ˆå±¬è¦ç¯„

---

**æ–‡ä»¶çµæŸ**
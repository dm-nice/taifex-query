# f01_fetcher é–‹ç™¼è¦ç¯„æ›¸

## ğŸ“‹ æ¨¡çµ„æ¦‚è¿°

**æ¨¡çµ„ç·¨è™Ÿ**: f01  
**æ¨¡çµ„åç¨±**: f01_fetcher  
**åŠŸèƒ½**: æŠ“å–å°æŒ‡æœŸè²¨å¤–è³‡çš„æœªå¹³å€‰æ·¨å£æ•¸ (Open Interest)  
**è³‡æ–™ä¾†æº**: å°ç£æœŸè²¨äº¤æ˜“æ‰€ (TAIFEX)

---

## ğŸŒ è³‡æ–™ä¾†æº

### API ç«¯é»
```
https://www.taifex.com.tw/cht/3/futContractsDate?queryType=1&marketCode=0&date=YYYY/MM/DD
```

### è³‡æ–™æ ¼å¼
- HTML è¡¨æ ¼
- è¡¨é ­å¯èƒ½ç‚º MultiIndexï¼ˆå¤šå±¤ï¼‰æˆ–å–®å±¤çµæ§‹
- éœ€è¦ç¯©é¸ã€Œå¤–è³‡ã€æˆ–ã€Œå¤–è³‡åŠé™¸è³‡ã€çš„è³‡æ–™

### ç›®æ¨™æ¬„ä½

| æ¬„ä½é¡åˆ¥ | æ¬„ä½åç¨± | èªªæ˜ |
|---------|---------|------|
| èº«ä»½åˆ¥ | èº«ä»½åˆ¥ / èº«ä»½ | ç”¨æ–¼ç¯©é¸å¤–è³‡è¡Œ |
| æœªå¹³å€‰é¤˜é¡ | å¤šæ–¹ > å£æ•¸ | å¤–è³‡å¤šå–®æœªå¹³å€‰å£æ•¸ |
| æœªå¹³å€‰é¤˜é¡ | ç©ºæ–¹ > å£æ•¸ | å¤–è³‡ç©ºå–®æœªå¹³å€‰å£æ•¸ |

---

## ğŸ”Œ ä»‹é¢è¦ç¯„

### å‡½å¼ç°½ç« 
```python
def fetch(date: str) -> dict:
    """
    æŠ“å–æŒ‡å®šæ—¥æœŸçš„å°æŒ‡æœŸè²¨å¤–è³‡æœªå¹³å€‰è³‡æ–™
    
    Args:
        date: æŸ¥è©¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
        
    Returns:
        çµæœå­—å…¸
    """
```

### å›å‚³æ ¼å¼

#### âœ… æˆåŠŸæ™‚
```json
{
  "module": "f01",
  "date": "2025-12-01",
  "status": "success",
  "summary": "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£ï¼ˆå¤šæ–¹ 18,268ï¼Œç©ºæ–¹ 47,300ï¼‰",
  "data": {
    "long_position": 18268,
    "short_position": 47300,
    "net_position": -29032
  },
  "source": "TAIFEX"
}
```

#### âŒ å¤±æ•—æ™‚
```json
{
  "module": "f01",
  "date": "2025-12-01",
  "status": "failed",
  "error": "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰"
}
```

#### ğŸ”´ éŒ¯èª¤æ™‚
```json
{
  "module": "f01",
  "date": "2025-12-01",
  "status": "error",
  "error": "é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"
}
```

---

## ğŸ“Š æ¬„ä½èªªæ˜

### å¿…è¦æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|------|
| module | string | æ¨¡çµ„è­˜åˆ¥ç¢¼ | "f01" |
| date | string | æŸ¥è©¢æ—¥æœŸ (YYYY-MM-DD) | "2025-12-01" |
| status | string | åŸ·è¡Œç‹€æ…‹ | "success" / "failed" / "error" |

### æˆåŠŸæ™‚é¡å¤–æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|------|
| summary | string | ä¸­æ–‡æ‘˜è¦ï¼ˆé¡¯ç¤ºç”¨ï¼‰ | "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£" |
| data | object | è³‡æ–™å…§å®¹ | è¦‹ä¸‹æ–¹èªªæ˜ |
| source | string | è³‡æ–™ä¾†æº | "TAIFEX" |

### data ç‰©ä»¶çµæ§‹

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ | ç¯„ä¾‹ |
|---------|------|------|------|
| long_position | integer | å¤šæ–¹å£æ•¸ | 18268 |
| short_position | integer | ç©ºæ–¹å£æ•¸ | 47300 |
| net_position | integer | æ·¨é¡ï¼ˆå¤šæ–¹ - ç©ºæ–¹ï¼‰ | -29032 |

### å¤±æ•—/éŒ¯èª¤æ™‚é¡å¤–æ¬„ä½

| æ¬„ä½åç¨± | é¡å‹ | èªªæ˜ |
|---------|------|------|
| error | string | éŒ¯èª¤è¨Šæ¯ï¼ˆä¸­æ–‡ï¼‰ |

---

## ğŸ¯ ç‹€æ…‹ç¢¼èªªæ˜

| ç‹€æ…‹ç¢¼ | èªªæ˜ | ä½¿ç”¨æ™‚æ©Ÿ |
|-------|------|---------|
| success | æˆåŠŸ | è³‡æ–™æŠ“å–æˆåŠŸä¸”æ ¼å¼æ­£ç¢º |
| failed | å¤±æ•— | ç„¡äº¤æ˜“è³‡æ–™ã€æ‰¾ä¸åˆ°æ¬„ä½ç­‰æ¥­å‹™é‚è¼¯å¤±æ•— |
| error | éŒ¯èª¤ | ç¶²è·¯éŒ¯èª¤ã€ç¨‹å¼ç•°å¸¸ç­‰æŠ€è¡“æ€§éŒ¯èª¤ |

---

## ğŸ› ï¸ æŠ€è¡“è¦æ±‚

### é–‹ç™¼ç’°å¢ƒ
- Python 3.9+
- å¿…è¦å¥—ä»¶: `requests`, `pandas`, `lxml`

### å®‰è£å¥—ä»¶
```bash
pip install requests pandas lxml
```

### ç¨‹å¼ç¢¼è¦æ±‚
1. å¿…é ˆæä¾› `fetch(date: str)` å‡½å¼
2. æ”¯æ´ç¨ç«‹åŸ·è¡Œæ¸¬è©¦
3. è™•ç† MultiIndex å’Œå–®å±¤è¡¨é ­å…©ç¨®æ ¼å¼
4. å®Œæ•´çš„éŒ¯èª¤è™•ç†
5. é©ç•¶çš„æ—¥èªŒè¨˜éŒ„

---

## ğŸ§ª æ¸¬è©¦æ–¹å¼

### å‘½ä»¤åˆ—æ¸¬è©¦
```bash
# ä½¿ç”¨é è¨­æ—¥æœŸ
python f01_fetcher.py

# æŒ‡å®šæ—¥æœŸ
python f01_fetcher.py 2025-12-01
```

### åœ¨ run.py ä¸­æ¸¬è©¦
```bash
# é©—æ”¶æ¨¡å¼
python run.py 2025-12-01 dev --module f01_fetcher

# æ­£å¼æ¨¡å¼
python run.py 2025-12-01
```

---

## âš ï¸ å¸¸è¦‹éŒ¯èª¤è™•ç†

| æƒ…æ³ | status | error è¨Šæ¯ç¯„ä¾‹ |
|------|--------|---------------|
| å‡æ—¥/ä¼‘å¸‚æ—¥ | failed | "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰" |
| æ‰¾ä¸åˆ°æ¬„ä½ | failed | "æ‰¾ä¸åˆ°èº«ä»½åˆ¥æ¬„ä½ï¼Œå¯ç”¨æ¬„ä½: [...]" |
| æ‰¾ä¸åˆ°å¤–è³‡ | failed | "æ‰¾ä¸åˆ°å¤–è³‡è³‡æ–™ï¼Œå¯ç”¨èº«ä»½åˆ¥: [...]" |
| ç¶²è·¯é€¾æ™‚ | error | "é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š" |
| HTTP éŒ¯èª¤ | error | "HTTP éŒ¯èª¤ 404" |
| æ—¥æœŸæ ¼å¼éŒ¯ | error | "æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼Œè«‹ä½¿ç”¨ YYYY-MM-DD" |
| æœªé æœŸéŒ¯èª¤ | error | "æœªé æœŸçš„éŒ¯èª¤: [è©³ç´°è¨Šæ¯]" |

---

## âœ… é©—æ”¶æ¨™æº–

### åŠŸèƒ½æ€§
- [ ] èƒ½æ­£ç¢ºæŠ“å–æŒ‡å®šæ—¥æœŸçš„è³‡æ–™
- [ ] èƒ½è™•ç† MultiIndex å’Œå–®å±¤è¡¨é ­
- [ ] èƒ½æ­£ç¢ºè¨ˆç®—æ·¨é¡ï¼ˆå¤šæ–¹ - ç©ºæ–¹ï¼‰
- [ ] èƒ½è­˜åˆ¥ã€Œå¤–è³‡ã€å’Œã€Œå¤–è³‡åŠé™¸è³‡ã€

### éŒ¯èª¤è™•ç†
- [ ] å‡æ—¥/ä¼‘å¸‚æ—¥å›å‚³ failed
- [ ] ç¶²è·¯éŒ¯èª¤å›å‚³ error
- [ ] æ—¥æœŸæ ¼å¼éŒ¯èª¤å›å‚³ error
- [ ] éŒ¯èª¤è¨Šæ¯æ¸…æ¥šæ˜ç¢ºï¼ˆä¸­æ–‡ï¼‰

### æ ¼å¼è¦ç¯„
- [ ] å›å‚³æ ¼å¼ç‚º dict
- [ ] åŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½
- [ ] status å€¼æ­£ç¢ºï¼ˆsuccess/failed/errorï¼‰
- [ ] ç¨‹å¼å…§éƒ¨ä½¿ç”¨è‹±æ–‡ key
- [ ] é¡¯ç¤ºè¨Šæ¯ä½¿ç”¨ä¸­æ–‡

### ç¨‹å¼ç¢¼å“è³ª
- [ ] æœ‰é©ç•¶çš„è¨»è§£å’Œ docstring
- [ ] æœ‰éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
- [ ] èƒ½ç¨ç«‹åŸ·è¡Œæ¸¬è©¦
- [ ] ç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°

---

## ğŸ“ ç¯„ä¾‹ç¨‹å¼ç¢¼ç‰‡æ®µ

### åŸºæœ¬çµæ§‹
```python
def fetch(date: str) -> dict:
    try:
        # 1. é©—è­‰æ—¥æœŸæ ¼å¼
        datetime.strptime(date, "%Y-%m-%d")
        
        # 2. å»ºç«‹ URL
        url = f"https://www.taifex.com.tw/cht/3/futContractsDate?..."
        
        # 3. ç™¼é€è«‹æ±‚
        response = requests.get(url, timeout=30)
        
        # 4. è§£æè¡¨æ ¼
        tables = pd.read_html(response.text)
        
        # 5. æå–è³‡æ–™
        # ... ä½ çš„é‚è¼¯ ...
        
        # 6. å›å‚³æˆåŠŸçµæœ
        return {
            "module": "f01",
            "date": date,
            "status": "success",
            "summary": "...",
            "data": {...},
            "source": "TAIFEX"
        }
        
    except requests.Timeout:
        return {
            "module": "f01",
            "date": date,
            "status": "error",
            "error": "é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"
        }
    except Exception as e:
        return {
            "module": "f01",
            "date": date,
            "status": "error",
            "error": f"æœªé æœŸçš„éŒ¯èª¤: {str(e)}"
        }
```

---

## ğŸ“‚ é©—æ”¶æµç¨‹

1. **é–‹ç™¼éšæ®µ**
   - åœ¨ `dev/` ç›®éŒ„ä¸‹é–‹ç™¼ `f01_fetcher_dev.py`
   - ä½¿ç”¨å¤šå€‹æ—¥æœŸé€²è¡Œæ¸¬è©¦

2. **é©—æ”¶æ¸¬è©¦**
   ```bash
   python run.py 2025-12-01 dev --module f01_fetcher_dev
   ```

3. **æª¢æŸ¥è¼¸å‡º**
   - æŸ¥çœ‹ `data/` ç›®éŒ„ä¸‹çš„ JSON æª”æ¡ˆ
   - æŸ¥çœ‹æ—¥èªŒæª”ç¢ºèªæ²’æœ‰éŒ¯èª¤

4. **é€šéé©—æ”¶**
   - å°‡æª”æ¡ˆç§»è‡³ `modules/` ç›®éŒ„
   - é‡æ–°å‘½åç‚º `f01_fetcher.py`
   - ç´å…¥æ­£å¼åŸ·è¡Œæµç¨‹

---

## ğŸ’¡ è¨­è¨ˆåŸå‰‡

### ç¨‹å¼å…§éƒ¨ - ä½¿ç”¨è‹±æ–‡
- è®Šæ•¸åç¨±: `long_position`, `short_position`
- å­—å…¸ key: `"status"`, `"data"`, `"module"`
- å‡½å¼åç¨±: `fetch()`, `extract_data()`

### å°å¤–é¡¯ç¤º - ä½¿ç”¨ä¸­æ–‡
- éŒ¯èª¤è¨Šæ¯: "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™"
- æ‘˜è¦è¨Šæ¯: "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£"
- æ—¥èªŒè¼¸å‡º: "åŸ·è¡Œæ¨¡çµ„: f01_fetcher"

### ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ
- **è‹±æ–‡**: ç¬¦åˆç¨‹å¼è¨­è¨ˆæ…£ä¾‹ï¼Œæ˜“æ–¼ç¶­è­·ï¼Œé¿å…ç·¨ç¢¼å•é¡Œ
- **ä¸­æ–‡**: ä½¿ç”¨è€…å‹å–„ï¼Œè¨Šæ¯æ¸…æ¥šæ˜“æ‡‚

---

## ğŸ“ æ”¯æ´

å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹åƒè€ƒï¼š
- `README.md` - å°ˆæ¡ˆæ•´é«”èªªæ˜
- `run.py` - æŸ¥çœ‹å¦‚ä½•æ•´åˆæ¨¡çµ„
- ç¾æœ‰æ¨¡çµ„ç¯„ä¾‹ - åƒè€ƒå…¶ä»–å·²å®Œæˆçš„ fetcher

---

**æœ€å¾Œæ›´æ–°**: 2025-12-04  
**ç‰ˆæœ¬**: 2.0ï¼ˆæ··åˆæ¨¡å¼ï¼‰
# å…±åŒé–‹ç™¼è¦ç¯„æ›¸

**ç‰ˆæœ¬**: 4.0
**æœ€å¾Œæ›´æ–°**: 2025-12-05
**é©ç”¨ç¯„åœ**: æ‰€æœ‰ fetcher æ¨¡çµ„

---

## ğŸ“‹ ç›®éŒ„

1. [å¿«é€Ÿåƒè€ƒ](#å¿«é€Ÿåƒè€ƒ-quick-reference) â­
2. [æ¦‚è¿°](#æ¦‚è¿°)
3. [æ ¸å¿ƒè¦ç¯„](#æ ¸å¿ƒè¦ç¯„)
4. [ä»‹é¢å®šç¾©](#ä»‹é¢å®šç¾©)
5. [è³‡æ–™æ ¼å¼æ¨™æº–](#è³‡æ–™æ ¼å¼æ¨™æº–)
6. [éŒ¯èª¤è™•ç†è¦ç¯„](#éŒ¯èª¤è™•ç†è¦ç¯„)
7. [é–‹ç™¼ç’°å¢ƒè¦æ±‚](#é–‹ç™¼ç’°å¢ƒè¦æ±‚)
8. [æ¸¬è©¦è¦ç¯„](#æ¸¬è©¦è¦ç¯„)
9. [äº¤ä»˜æª¢æŸ¥æ¸…å–®](#äº¤ä»˜æª¢æŸ¥æ¸…å–®)
10. [å¸¸è¦‹å•é¡Œ FAQ](#å¸¸è¦‹å•é¡Œ-faq)

---

## å¿«é€Ÿåƒè€ƒ (Quick Reference)

> ğŸ’¡ **çµ¦è¶•æ™‚é–“çš„é–‹ç™¼è€…**ï¼šé€™è£¡æ˜¯æœ€æ ¸å¿ƒçš„è¦ç¯„ï¼Œ10åˆ†é˜å¿«é€Ÿä¸Šæ‰‹ï¼
>
> è©³ç´°èªªæ˜è«‹å¾€ä¸‹é–±è®€å„ç« ç¯€ã€‚

### ğŸ¯ çµ±ä¸€æ–‡å­—æ ¼å¼è¦ç¯„ (v4.0)

#### âœ… æˆåŠŸæ™‚æ ¼å¼
```
[ YYYY.MM.DD  FXX{æè¿°}   source: {ä¾†æº} ]
```

**ç¯„ä¾‹**:
```
[ 2025.12.03  F01å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,439 å£ï¼ˆå¤šæ–¹ 19,214ï¼Œç©ºæ–¹ 48,653ï¼‰   source: TAIFEX ]
```

**æ ¼å¼å…ƒç´ **:
- `[ ... ]` - ä¸­æ‹¬è™Ÿ + ç©ºæ ¼
- `YYYY.MM.DD` - æ—¥æœŸæ ¼å¼ï¼ˆé»åˆ†éš”ï¼‰
- `FXX` - æ¨¡çµ„ä»£è™Ÿï¼ˆå¤§å¯«å­—æ¯ + æ•¸å­—ï¼‰
- `{æè¿°}` - æ¨¡çµ„ç‰¹å®šçš„ä¸­æ–‡æè¿° + æ•¸æ“š
- `{æ•¸å€¼}` - ä½¿ç”¨åƒåˆ†ä½é€—è™Ÿï¼ˆå¦‚ -29,439ï¼‰
- `source: {ä¾†æº}` - å›ºå®šæ ¼å¼æ¨™è¨˜è³‡æ–™ä¾†æº

#### âŒ éŒ¯èª¤æ™‚æ ¼å¼
```
[ YYYY.MM.DD  FXX éŒ¯èª¤: {éŒ¯èª¤è¨Šæ¯}   source: {ä¾†æº} ]
```

**ç¯„ä¾‹**:
```
[ 2025.11.30  F01 éŒ¯èª¤: è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰   source: TAIFEX ]
```

**è¦å‰‡**:
- éŒ¯èª¤æ¨™è¨˜: `{æ¨¡çµ„ä»£è™Ÿ} éŒ¯èª¤: {éŒ¯èª¤è¨Šæ¯}`
- ä¸å€åˆ† failed/errorï¼ˆçµ±ä¸€ç‚ºéŒ¯èª¤æ ¼å¼ï¼‰
- éŒ¯èª¤è¨Šæ¯ä½¿ç”¨ä¸­æ–‡ï¼Œæ¸…æ¥šæè¿°å•é¡Œ

### ğŸ”§ å¿…é ˆå¯¦ä½œçš„å‡½å¼

```python
def fetch(date: str) -> str:
    """
    æŠ“å–æŒ‡å®šæ—¥æœŸçš„è³‡æ–™

    Args:
        date: æŸ¥è©¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD

    Returns:
        çµ±ä¸€æ ¼å¼çš„æ–‡å­—å­—ä¸²
    """
```

### ğŸ“ æ ¼å¼åŒ–å‡½å¼ç¯„æœ¬

```python
from typing import Dict, Optional

def format_fxx_output(date: str, status: str, data: Optional[Dict] = None, error: Optional[str] = None) -> str:
    """æ ¼å¼åŒ–è¼¸å‡ºç‚ºçµ±ä¸€æ–‡å­—æ ¼å¼"""
    date_formatted = date.replace("-", ".")  # YYYY-MM-DD â†’ YYYY.MM.DD

    if status == "success" and data:
        # æ ¹æ“šæ¨¡çµ„ç‰¹æ€§æ ¼å¼åŒ–æˆåŠŸè¼¸å‡º
        value = data.get("some_value", 0)
        return f"[ {date_formatted}  FXX{æè¿°} {value:,}   source: {ä¾†æº} ]"
    else:
        error_msg = error or "æœªçŸ¥éŒ¯èª¤"
        return f"[ {date_formatted}  FXX éŒ¯èª¤: {error_msg}   source: {ä¾†æº} ]"
```

### âœ… å››å¤§è¦ç¯„

1. âœ… **å›å‚³é¡å‹**ï¼šå¿…é ˆæ˜¯ `str`ï¼ˆçµ±ä¸€æ–‡å­—æ ¼å¼ï¼‰
2. âœ… **éŒ¯èª¤è™•ç†**ï¼šæ‰€æœ‰éŒ¯èª¤éƒ½è½‰æ›ç‚ºæ–‡å­—æ ¼å¼ï¼Œä¸æ‹‹å‡ºä¾‹å¤–
3. âœ… **æ—¥æœŸæ ¼å¼**ï¼šè¼¸å…¥ `YYYY-MM-DD` â†’ è¼¸å‡º `YYYY.MM.DD`
4. âœ… **æ¨¡çµ„ä»£è™Ÿ**ï¼šå¤§å¯«ï¼ˆF01, F02...ï¼‰

---

## æ¦‚è¿°

### å°ˆæ¡ˆæ¶æ§‹

```
C:\Taifex\
â”œâ”€â”€ run.py              # ä¸»æ§ç¨‹å¼ï¼ˆä¸éœ€ä¿®æ”¹ï¼‰
â”œâ”€â”€ modules\            # æ­£å¼æ¨¡çµ„ç›®éŒ„
â”‚   â””â”€â”€ xxx_fetcher.py
â”œâ”€â”€ dev\                # é–‹ç™¼/é©—æ”¶ç›®éŒ„
â”‚   â””â”€â”€ xxx_fetcher_dev.py
â””â”€â”€ data\               # è¼¸å‡ºç›®éŒ„ï¼ˆè‡ªå‹•ç”¢ç”Ÿï¼‰
    â”œâ”€â”€ YYYY-MM-DD_xxx_fetcher.json
    â””â”€â”€ YYYY-MM-DD_run.log
```

### å·¥ä½œæµç¨‹

```
é–‹ç™¼éšæ®µ              é©—æ”¶éšæ®µ              æ­£å¼éšæ®µ
   â†“                     â†“                     â†“
å¯«åœ¨ dev/         run.py æ¸¬è©¦           ç§»è‡³ modules/
xxx_dev.py       ç”¢ç”Ÿ JSON             æ”¹å xxx.py
   â†“                     â†“                     â†“
ç¨ç«‹æ¸¬è©¦           æª¢æŸ¥æ ¼å¼              è‡ªå‹•åŸ·è¡Œ
å¯åŸ·è¡Œ             æª¢æŸ¥çµæœ              æ¯æ—¥æ’ç¨‹
```

---

## æ ¸å¿ƒè¦ç¯„

### 1. æ··åˆæ¨¡å¼è¨­è¨ˆåŸå‰‡ â­â­â­

**é€™æ˜¯æœ€é‡è¦çš„è¦ç¯„ï¼**

#### ç¨‹å¼å…§éƒ¨ï¼šä½¿ç”¨è‹±æ–‡ key
```python
# âœ… æ­£ç¢º
return {
    "module": "f01",
    "date": "2025-12-01",
    "status": "success",
    "data": {...}
}

# âŒ éŒ¯èª¤
return {
    "æ¨¡çµ„": "f01",      # ä¸è¦ç”¨ä¸­æ–‡ key
    "æ—¥æœŸ": "2025-12-01",
    "ç‹€æ…‹": "æˆåŠŸ"
}
```

#### ä½¿ç”¨è€…çœ‹åˆ°çš„ï¼šä½¿ç”¨ä¸­æ–‡è¨Šæ¯
```python
# âœ… æ­£ç¢ºï¼šè¨Šæ¯å…§å®¹ç”¨ä¸­æ–‡
"summary": "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£ï¼ˆå¤šæ–¹ 18,268ï¼Œç©ºæ–¹ 47,300ï¼‰"
"error": "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰"

# âŒ éŒ¯èª¤ï¼šè¨Šæ¯ç”¨è‹±æ–‡
"summary": "Foreign net position: -29,032"
"error": "No trading data available"
```

#### ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ

| é¢å‘ | èªè¨€ | åŸå›  |
|------|------|------|
| ç¨‹å¼å…§éƒ¨ï¼ˆkeyï¼‰ | è‹±æ–‡ | ç¬¦åˆåœ‹éš›æ¨™æº–ã€é¿å…ç·¨ç¢¼å•é¡Œã€æ˜“æ–¼ç¶­è­· |
| ä½¿ç”¨è€…ä»‹é¢ï¼ˆè¨Šæ¯ï¼‰ | ä¸­æ–‡ | å‹å–„æ˜“æ‡‚ã€æœ¬åœ°åŒ–é«”é©— |

---

## ä»‹é¢å®šç¾©

### å¿…é ˆå¯¦ä½œçš„å‡½å¼

```python
def fetch(date: str) -> str:
    """
    æŠ“å–æŒ‡å®šæ—¥æœŸçš„è³‡æ–™

    Args:
        date: æŸ¥è©¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD

    Returns:
        çµ±ä¸€æ ¼å¼çš„æ–‡å­—å­—ä¸²
        æ ¼å¼: [ YYYY.MM.DD  FXX{æè¿°}   source: {ä¾†æº} ]
    """
```

### å‡½å¼è¦ç¯„

- âœ… **å‡½å¼åç¨±**ï¼šå¿…é ˆæ˜¯ `fetch`
- âœ… **åƒæ•¸**ï¼šåªæ¥å—ä¸€å€‹åƒæ•¸ `date: str` (YYYY-MM-DD)
- âœ… **å›å‚³**ï¼šå¿…é ˆæ˜¯ `str`ï¼ˆçµ±ä¸€æ ¼å¼æ–‡å­—ï¼‰
- âœ… **ä¸æ‹‹å‡ºä¾‹å¤–**ï¼šæ‰€æœ‰éŒ¯èª¤éƒ½ç”¨éŒ¯èª¤æ ¼å¼æ–‡å­—è¡¨ç¤º

---

## è³‡æ–™æ ¼å¼æ¨™æº–

### çµ±ä¸€æ–‡å­—æ ¼å¼å®šç¾©

æ‰€æœ‰æ¨¡çµ„å¿…é ˆå›å‚³çµ±ä¸€æ ¼å¼çš„æ–‡å­—å­—ä¸²ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

#### âœ… æˆåŠŸæ™‚

```
[ 2025.12.03  F01å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,439 å£ï¼ˆå¤šæ–¹ 19,214ï¼Œç©ºæ–¹ 48,653ï¼‰   source: TAIFEX ]
```

**æ ¼å¼è¦ç¯„**ï¼š
- å¤–æ¡†: `[ ... ]` (ä¸­æ‹¬è™Ÿ + ç©ºæ ¼)
- æ—¥æœŸ: `YYYY.MM.DD` (é»åˆ†éš”)
- æ¨¡çµ„ä»£è™Ÿ: å¤§å¯«å­—æ¯ + æ•¸å­— (å¦‚ F01, F02)
- æè¿°: æ¨¡çµ„ç‰¹å®šçš„ä¸­æ–‡æè¿° + æ•¸æ“š
- ä¾†æº: å›ºå®šæ ¼å¼ `source: {ä¾†æºåç¨±}`

#### âŒ å¤±æ•—/éŒ¯èª¤æ™‚

```
[ 2025.11.30  F01 éŒ¯èª¤: è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰   source: TAIFEX ]
```

**æ ¼å¼è¦ç¯„**ï¼š
- éŒ¯èª¤æ¨™è¨˜: `{æ¨¡çµ„ä»£è™Ÿ} éŒ¯èª¤: {éŒ¯èª¤è¨Šæ¯}`
- ä¸å†å€åˆ† failed/error (çµ±ä¸€ç‚ºéŒ¯èª¤æ ¼å¼)
- éŒ¯èª¤è¨Šæ¯ä½¿ç”¨ä¸­æ–‡ï¼Œæ¸…æ¥šæè¿°å•é¡Œ

### æ—¥æœŸæ ¼å¼è½‰æ›

```python
date = "2025-12-03"  # è¼¸å…¥
date_formatted = date.replace("-", ".")  # è½‰æ›
# è¼¸å‡º: "2025.12.03"
```

### æ¨¡çµ„ä»£è™Ÿæå–

å¾æ¨¡çµ„åç¨±æå–ä»£è™Ÿï¼š

```python
import re

def extract_module_id(module_name: str) -> str:
    """æå–æ¨¡çµ„ä»£è™Ÿ"""
    match = re.match(r'([a-z]\d+)', module_name, re.IGNORECASE)
    if match:
        return match.group(1).upper()
    return "FXX"
```

---

## éŒ¯èª¤è™•ç†è¦ç¯„

### ç‹€æ…‹ç¢¼ä½¿ç”¨æ™‚æ©Ÿ

| ç‹€æ…‹ç¢¼ | ä½¿ç”¨æ™‚æ©Ÿ | ç¯„ä¾‹ |
|--------|---------|------|
| success | æˆåŠŸå–å¾—è³‡æ–™ | æ­£å¸¸äº¤æ˜“æ—¥ï¼Œè³‡æ–™å®Œæ•´ |
| failed | æ¥­å‹™é‚è¼¯å¤±æ•— | å‡æ—¥ç„¡è³‡æ–™ã€æ‰¾ä¸åˆ°æ¬„ä½ã€æ¬„ä½æ ¼å¼ç•°å¸¸ |
| error | æŠ€è¡“æ€§éŒ¯èª¤ | ç¶²è·¯é€¾æ™‚ã€HTTP éŒ¯èª¤ã€æ—¥æœŸæ ¼å¼éŒ¯èª¤ |

### å¿…é ˆè™•ç†çš„éŒ¯èª¤æƒ…æ³

#### 1. ç¶²è·¯ç›¸é—œéŒ¯èª¤ â†’ error

```python
try:
    response = requests.get(url, timeout=30)
    response.raise_for_status()
except requests.Timeout:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "error",
        "error": "é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"
    }
except requests.HTTPError as e:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "error",
        "error": f"HTTP éŒ¯èª¤ {e.response.status_code}"
    }
except requests.RequestException as e:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "error",
        "error": f"ç¶²è·¯è«‹æ±‚å¤±æ•—: {str(e)}"
    }
```

#### 2. è³‡æ–™æ ¼å¼éŒ¯èª¤ â†’ failed

```python
# æ‰¾ä¸åˆ°è¡¨æ ¼
if len(tables) == 0:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "failed",
        "error": "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰"
    }

# æ‰¾ä¸åˆ°ç›®æ¨™æ¬„ä½
if target_col is None:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "failed",
        "error": f"æ‰¾ä¸åˆ°ç›®æ¨™æ¬„ä½ï¼Œå¯ç”¨æ¬„ä½: {df.columns.tolist()}"
    }
```

#### 3. åƒæ•¸éŒ¯èª¤ â†’ error

```python
try:
    datetime.strptime(date, "%Y-%m-%d")
except ValueError:
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "error",
        "error": "æ—¥æœŸæ ¼å¼éŒ¯èª¤ï¼Œè«‹ä½¿ç”¨ YYYY-MM-DD"
    }
```

#### 4. æœªé æœŸçš„éŒ¯èª¤ â†’ error

```python
except Exception as e:
    logger.exception("æœªé æœŸçš„éŒ¯èª¤")
    return {
        "module": MODULE_ID,
        "date": date,
        "status": "error",
        "error": f"æœªé æœŸçš„éŒ¯èª¤: {str(e)}"
    }
```

### éŒ¯èª¤è¨Šæ¯æ’°å¯«åŸå‰‡

âœ… **å¥½çš„éŒ¯èª¤è¨Šæ¯**ï¼š
- "æ‰¾ä¸åˆ°èº«ä»½åˆ¥æ¬„ä½ï¼Œå¯ç”¨æ¬„ä½: ['å•†å“', 'äº¤æ˜“äºº', 'å¤šæ–¹']"
- "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰"
- "é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š"

âŒ **ä¸å¥½çš„éŒ¯èª¤è¨Šæ¯**ï¼š
- "éŒ¯èª¤" ï¼ˆå¤ªç± çµ±ï¼‰
- "Error: KeyError" ï¼ˆè‹±æ–‡ + æŠ€è¡“è¡“èªï¼‰
- "list index out of range" ï¼ˆPython åŸå§‹éŒ¯èª¤ï¼‰

---

## é–‹ç™¼ç’°å¢ƒè¦æ±‚

### Python ç‰ˆæœ¬
- **æœ€ä½è¦æ±‚**: Python 3.9+
- **å»ºè­°ç‰ˆæœ¬**: Python 3.11+

### å¿…è¦å¥—ä»¶

```bash
pip install requests pandas lxml
```

| å¥—ä»¶ | ç”¨é€” | ç‰ˆæœ¬è¦æ±‚ |
|------|------|---------|
| requests | HTTP è«‹æ±‚ | >= 2.28.0 |
| pandas | è³‡æ–™è™•ç† | >= 2.0.0 |
| lxml | HTML è§£æ | >= 4.9.0 |

### æ¨¡çµ„çµæ§‹ç¯„æœ¬

```python
"""
æ¨¡çµ„èªªæ˜æ–‡å­—
"""

import sys
import json
import logging
import requests
import pandas as pd
from datetime import datetime
from typing import Dict, Optional

# æ¨¡çµ„è­˜åˆ¥
MODULE_ID = "f01"  # å°æ‡‰ JSON çš„ "module" æ¬„ä½
MODULE_NAME = "f01_fetcher"

# è¨­å®š logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(message)s'
)
logger = logging.getLogger(__name__)


def fetch(date: str) -> dict:
    """ä¸»è¦å‡½å¼"""
    # ä½ çš„å¯¦ä½œ...
    pass


def main():
    """ç¨ç«‹æ¸¬è©¦ç”¨"""
    if len(sys.argv) > 1:
        test_date = sys.argv[1]
    else:
        test_date = '2025-11-28'
    
    result = fetch(test_date)
    print(json.dumps(result, ensure_ascii=False, indent=2))
    
    sys.exit(0 if result.get("status") == "success" else 1)


if __name__ == '__main__':
    main()
```

---

## æ¸¬è©¦è¦ç¯„

### ç¨ç«‹æ¸¬è©¦

ä½ çš„ç¨‹å¼å¿…é ˆèƒ½å¤ ç¨ç«‹åŸ·è¡Œï¼š

```bash
# ä½¿ç”¨é è¨­æ—¥æœŸ
python f01_fetcher_dev.py

# æŒ‡å®šæ—¥æœŸ
python f01_fetcher_dev.py 2025-12-01
```

**è¼¸å‡ºè¦æ±‚**ï¼š
- âœ… å°å‡º JSON æ ¼å¼çš„çµæœ
- âœ… æ ¹æ“šç‹€æ…‹è¨­å®šé€€å‡ºç¢¼ï¼ˆ0=æˆåŠŸ, 1=å¤±æ•—ï¼‰

### æ•´åˆæ¸¬è©¦

é€é run.py æ¸¬è©¦ï¼š

```bash
# é©—æ”¶æ¨¡å¼
python run.py 2025-12-01 dev --module f01_fetcher_dev

# æª¢æŸ¥è¼¸å‡º
type data\2025-12-04_f01_fetcher_dev_dev.json
```

### æ¸¬è©¦æ¡ˆä¾‹è¦æ±‚

**æ¯å€‹æ¨¡çµ„è‡³å°‘éœ€è¦ 3 å€‹æ¸¬è©¦æ¡ˆä¾‹**ï¼š

1. **æ­£å¸¸äº¤æ˜“æ—¥** â†’ é æœŸ `status: "success"`
2. **å‡æ—¥/ä¼‘å¸‚æ—¥** â†’ é æœŸ `status: "failed"`
3. **é‚Šç•Œæƒ…æ³** â†’ æ ¹æ“šæ¨¡çµ„ç‰¹æ€§æ±ºå®š

ç¯„ä¾‹ï¼š
```python
# æ¸¬è©¦æ¡ˆä¾‹å¯«åœ¨è¦ç¯„æ›¸ä¸­
| æ¸¬è©¦æ—¥æœŸ | é æœŸç‹€æ…‹ | é æœŸè³‡æ–™ | å‚™è¨» |
|---------|---------|---------|------|
| 2025-12-02 | success | å¤šæ–¹: 18808, ç©ºæ–¹: 48032 | æ­£å¸¸äº¤æ˜“æ—¥ |
| 2025-11-30 | failed | - | é€±å…­ç„¡äº¤æ˜“ |
| 2025-12-25 | failed | - | è–èª•ç¯€ä¼‘å¸‚ |
```

---

## äº¤ä»˜æª¢æŸ¥æ¸…å–®

### æª”æ¡ˆäº¤ä»˜

- [ ] æª”æ¡ˆåç¨±æ­£ç¢ºï¼š`xxx_fetcher_dev.py`
- [ ] æ”¾åœ¨æ­£ç¢ºä½ç½®ï¼š`dev/` ç›®éŒ„
- [ ] åŒ…å« `fetch()` å‡½å¼
- [ ] åŒ…å« `main()` å‡½å¼ï¼ˆä¾›ç¨ç«‹æ¸¬è©¦ï¼‰

### æ ¼å¼æª¢æŸ¥

- [ ] å›å‚³æ ¼å¼ç‚º `dict`
- [ ] åŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½
- [ ] `status` å€¼æ­£ç¢ºï¼ˆ"success" / "failed" / "error"ï¼‰
- [ ] ç¨‹å¼å…§éƒ¨ä½¿ç”¨è‹±æ–‡ key
- [ ] é¡¯ç¤ºè¨Šæ¯ä½¿ç”¨ä¸­æ–‡

### åŠŸèƒ½æª¢æŸ¥

- [ ] èƒ½æ­£ç¢ºæŠ“å–ç›®æ¨™è³‡æ–™
- [ ] èƒ½è™•ç†å‡æ—¥/ä¼‘å¸‚æ—¥
- [ ] èƒ½è™•ç†ç¶²è·¯éŒ¯èª¤
- [ ] èƒ½è™•ç†è³‡æ–™æ ¼å¼ç•°å¸¸
- [ ] éŒ¯èª¤è¨Šæ¯æ¸…æ¥šæ˜ç¢º

### ç¨‹å¼ç¢¼å“è³ª

- [ ] æœ‰é©ç•¶çš„è¨»è§£å’Œ docstring
- [ ] æœ‰å®Œæ•´çš„éŒ¯èª¤è™•ç†ï¼ˆtry-exceptï¼‰
- [ ] ä¸æœƒç›´æ¥æ‹‹å‡ºæœªè™•ç†çš„ Exception
- [ ] èƒ½ç¨ç«‹åŸ·è¡Œæ¸¬è©¦
- [ ] ç¨‹å¼ç¢¼çµæ§‹æ¸…æ™°

### é©—æ”¶æ¸¬è©¦

```bash
# 1. ç¨ç«‹æ¸¬è©¦
python dev/xxx_fetcher_dev.py 2025-12-01

# 2. æ•´åˆæ¸¬è©¦
python run.py 2025-12-01 dev --module xxx_fetcher_dev

# 3. æª¢æŸ¥è¼¸å‡º
type data\2025-12-04_xxx_fetcher_dev_dev.json
```

**é€šéæ¨™æº–**ï¼š
- âœ… JSON æ ¼å¼æ­£ç¢º
- âœ… å¿…è¦æ¬„ä½å®Œæ•´
- âœ… è³‡æ–™å€¼ä¸æ˜¯ "-" æˆ–ç©º
- âœ… éŒ¯èª¤æƒ…æ³æœ‰æ¸…æ¥šè¨Šæ¯

---

## å¸¸è¦‹å•é¡Œ FAQ

### Q1: ç‚ºä»€éº¼è¦ç”¨è‹±æ–‡ key ä½†ä¸­æ–‡è¨Šæ¯ï¼Ÿ

**A**: é€™æ˜¯æ··åˆæ¨¡å¼è¨­è¨ˆï¼š
- **è‹±æ–‡ key**: ç¬¦åˆç¨‹å¼è¨­è¨ˆæ…£ä¾‹ï¼Œé¿å…ç·¨ç¢¼å•é¡Œï¼Œä¾¿æ–¼åœ‹éš›åŒ–
- **ä¸­æ–‡è¨Šæ¯**: ä½¿ç”¨è€…å‹å–„ï¼Œè¨Šæ¯æ¸…æ¥šæ˜“æ‡‚

ç¯„ä¾‹ï¼š
```json
{
  "status": "success",              // â† ç¨‹å¼ç”¨è‹±æ–‡ key
  "summary": "å°æŒ‡æœŸå¤–è³‡æ·¨é¡ -29,032 å£"  // â† ä½¿ç”¨è€…çœ‹ä¸­æ–‡è¨Šæ¯
}
```

### Q2: data è£¡é¢çš„ key è¦ç”¨è‹±æ–‡é‚„æ˜¯ä¸­æ–‡ï¼Ÿ

**A**: **å¿…é ˆç”¨è‹±æ–‡**ï¼

```json
{
  "data": {
    "long_position": 18268,    // âœ… æ­£ç¢º
    "short_position": 47300    // âœ… æ­£ç¢º
  }
}

// âŒ éŒ¯èª¤
{
  "data": {
    "å¤šæ–¹å£æ•¸": 18268,
    "ç©ºæ–¹å£æ•¸": 47300
  }
}
```

ä½†åœ¨ `summary` å¯ä»¥ç”¨ä¸­æ–‡ï¼š
```json
{
  "summary": "å¤šæ–¹å£æ•¸ 18,268ï¼Œç©ºæ–¹å£æ•¸ 47,300"  // âœ… é€™è£¡å¯ä»¥ç”¨ä¸­æ–‡
}
```

### Q3: status æ‡‰è©²ç”¨ "success" é‚„æ˜¯ "æˆåŠŸ"ï¼Ÿ

**A**: **å¿…é ˆç”¨ "success"**ï¼

```python
# âœ… æ­£ç¢º
"status": "success"
"status": "failed"
"status": "error"

# âŒ éŒ¯èª¤
"status": "æˆåŠŸ"
"status": "å¤±æ•—"
"status": "éŒ¯èª¤"
```

### Q4: å‡æ—¥ç„¡è³‡æ–™æ‡‰è©²å›å‚³ failed é‚„æ˜¯ errorï¼Ÿ

**A**: **å›å‚³ failed**

- `failed`: æ¥­å‹™é‚è¼¯å¤±æ•—ï¼ˆå‡æ—¥æœ¬ä¾†å°±æ²’è³‡æ–™ï¼Œé€™æ˜¯æ­£å¸¸çš„ï¼‰
- `error`: æŠ€è¡“æ€§éŒ¯èª¤ï¼ˆä¾‹å¦‚ç¶²è·¯æ–·ç·šï¼Œé€™æ˜¯ç•°å¸¸çš„ï¼‰

```python
# âœ… æ­£ç¢º
if len(tables) == 0:
    return {
        "status": "failed",
        "error": "è©²æ—¥ç„¡äº¤æ˜“è³‡æ–™ï¼ˆå¯èƒ½æ˜¯å‡æ—¥æˆ–ä¼‘å¸‚æ—¥ï¼‰"
    }
```

### Q5: éŒ¯èª¤è¨Šæ¯è¦å¯«å¤šè©³ç´°ï¼Ÿ

**A**: ç›¡é‡è©³ç´°ï¼Œä½†è¦ç”¨ä¸­æ–‡ï¼

```python
# âœ… å¾ˆå¥½ï¼šè©³ç´°ä¸”æœ‰å¹«åŠ©
"error": "æ‰¾ä¸åˆ°èº«ä»½åˆ¥æ¬„ä½ï¼Œå¯ç”¨æ¬„ä½: ['å•†å“', 'äº¤æ˜“äºº', 'å¤šæ–¹', 'ç©ºæ–¹']"

# âš ï¸ æ™®é€šï¼šæœ‰åŸºæœ¬è³‡è¨Š
"error": "æ‰¾ä¸åˆ°èº«ä»½åˆ¥æ¬„ä½"

# âŒ ä¸å¥½ï¼šå¤ªç± çµ±
"error": "è³‡æ–™éŒ¯èª¤"

# âŒ å¾ˆç³Ÿï¼šè‹±æ–‡ + æŠ€è¡“è¡“èª
"error": "KeyError: 'èº«ä»½åˆ¥'"
```

### Q6: éœ€è¦è™•ç†ç·¨ç¢¼å•é¡Œå—ï¼Ÿ

**A**: é€šå¸¸ä¸éœ€è¦ï¼Œä½†å»ºè­°è¨­å®šï¼š

```python
response = requests.get(url, timeout=30)
response.encoding = "utf-8"  # â† æ˜ç¢ºæŒ‡å®š UTF-8
```

### Q7: éœ€è¦å¯« docstring å—ï¼Ÿ

**A**: **å¿…é ˆï¼** è‡³å°‘è¦æœ‰ `fetch()` å‡½å¼çš„ docstringï¼š

```python
def fetch(date: str) -> dict:
    """
    æŠ“å–æŒ‡å®šæ—¥æœŸçš„å°æŒ‡æœŸè²¨å¤–è³‡æœªå¹³å€‰è³‡æ–™
    
    Args:
        date: æŸ¥è©¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD
        
    Returns:
        çµæœå­—å…¸ï¼ŒåŒ…å« status, data ç­‰æ¬„ä½
    """
```

### Q8: å¯ä»¥åŠ å…¥è‡ªå·±çš„è¼”åŠ©å‡½å¼å—ï¼Ÿ

**A**: **å¯ä»¥ï¼** é¼“å‹µå°‡è¤‡é›œé‚è¼¯æ‹†åˆ†æˆå°å‡½å¼ï¼š

```python
def convert_to_int(value) -> int:
    """è¼”åŠ©å‡½å¼ï¼šè½‰æ›ç‚ºæ•´æ•¸"""
    if pd.isna(value):
        return 0
    return int(str(value).replace(',', '').strip())

def find_target_column(df, keywords):
    """è¼”åŠ©å‡½å¼ï¼šå°‹æ‰¾ç›®æ¨™æ¬„ä½"""
    # ...
```

### Q9: è¦æ€éº¼æ¸¬è©¦æˆ‘çš„ç¨‹å¼ï¼Ÿ

**A**: ä¸‰æ­¥é©Ÿæ¸¬è©¦æ³•ï¼š

```bash
# 1. ç¨ç«‹æ¸¬è©¦ï¼ˆå¿«é€Ÿé©—è­‰ï¼‰
python xxx_fetcher_dev.py 2025-12-01

# 2. æ•´åˆæ¸¬è©¦ï¼ˆå®Œæ•´æµç¨‹ï¼‰
python run.py 2025-12-01 dev --module xxx_fetcher_dev

# 3. æª¢æŸ¥è¼¸å‡ºï¼ˆç¢ºèªçµæœï¼‰
type data\2025-12-04_xxx_fetcher_dev_dev.json
```

### Q10: æˆ‘çš„ç¨‹å¼é€šéé©—æ”¶å¾Œå‘¢ï¼Ÿ

**A**: é©—æ”¶é€šéå¾Œçš„æµç¨‹ï¼š

1. å°‡æª”æ¡ˆç§»è‡³ `modules/` ç›®éŒ„
2. é‡æ–°å‘½åï¼ˆç§»é™¤ `_dev`ï¼‰ï¼š`xxx_fetcher.py`
3. ç´å…¥æ­£å¼åŸ·è¡Œæµç¨‹
4. ç”± `run.py` è‡ªå‹•å‘¼å«

```bash
# ç§»å‹•æª”æ¡ˆ
move dev\xxx_fetcher_dev.py modules\xxx_fetcher.py

# æ­£å¼åŸ·è¡Œ
python run.py 2025-12-01
```

---

## é™„éŒ„ï¼šå®Œæ•´ç¯„ä¾‹

### æœ€å°å¯ç”¨ç¯„ä¾‹

```python
"""
æœ€å°å¯ç”¨çš„ fetcher ç¯„ä¾‹
"""

import sys
import json
import requests
import pandas as pd
from datetime import datetime

MODULE_ID = "example"

def fetch(date: str) -> dict:
    """æŠ“å–è³‡æ–™"""
    try:
        # é©—è­‰æ—¥æœŸ
        datetime.strptime(date, "%Y-%m-%d")
        
        # ç™¼é€è«‹æ±‚
        url = "https://example.com/api"
        response = requests.get(url, timeout=30)
        response.raise_for_status()
        
        # è§£æè³‡æ–™
        data = response.json()
        
        # å›å‚³æˆåŠŸ
        return {
            "module": MODULE_ID,
            "date": date,
            "status": "success",
            "summary": "æˆåŠŸå–å¾—è³‡æ–™",
            "data": {
                "value": data["value"]
            },
            "source": "EXAMPLE"
        }
        
    except requests.Timeout:
        return {
            "module": MODULE_ID,
            "date": date,
            "status": "error",
            "error": "é€£ç·šé€¾æ™‚"
        }
    except Exception as e:
        return {
            "module": MODULE_ID,
            "date": date,
            "status": "error",
            "error": f"æœªé æœŸçš„éŒ¯èª¤: {str(e)}"
        }

def main():
    """æ¸¬è©¦ç”¨"""
    test_date = sys.argv[1] if len(sys.argv) > 1 else '2025-12-01'
    result = fetch(test_date)
    print(json.dumps(result, ensure_ascii=False, indent=2))
    sys.exit(0 if result.get("status") == "success" else 1)

if __name__ == '__main__':
    main()
```

---

**æ–‡ä»¶çµæŸ**

æœ‰ä»»ä½•å•é¡Œè«‹åƒè€ƒå€‹åˆ¥æ¨¡çµ„çš„é–‹ç™¼è¦ç¯„æ›¸ï¼Œæˆ–è¯ç¹«å°ˆæ¡ˆè² è²¬äººã€‚
📄 最新版 f01_fetcher_dev_範例.md（放在 outsource/）
markdown
# f01_fetcher_dev_規範書（改進版）

## 📋 目標
抓取台指期貨外資的未平倉淨口數 (OI)

## 📊 數據來源
- **URL**: https://www.taifex.com.tw/cht/3/futContractsDate?queryType=1&marketCode=0&date=YYYY/MM/DD
- **方式**: HTML 表格爬蟲
- **表格結構**: 多層表頭 (MultiIndex)
  - 第 1 層：交易類別（如「未平倉餘額」）
  - 第 2 層：方向（多方/空方）
  - 第 3 層：數據類型（口數/契約金額）

## 🔍 需抓取的欄位

| 類別 | 欄位名稱 | 說明 |
|------|--------|------|
| 身份別 | 身份別 | 用於篩選「外資」行 |
| 未平倉餘額 | 多方 > 口數 | 外資多單未平倉口數 |
| 未平倉餘額 | 空方 > 口數 | 外資空單未平倉口數 |

## 📤 輸出格式

### ✅ 成功（狀態: "成功"）
```json
{
  "模組": "f01",
  "日期": "2025-12-01",
  "狀態": "成功",
  "摘要": "F1: 台指期外資淨額：-29032（多：18268，空：47300）",
  "資料": {
    "外資多單口數": 18268,
    "外資空單口數": 47300,
    "外資多空淨額": -29032
  },
  "來源": "TAIFEX"
}
```

### ❌ 失敗（狀態: "失敗"）
```json
{
  "模組": "f01",
  "日期": "2025-12-01",
  "狀態": "失敗",
  "錯誤": "該日無交易資料或網頁結構異常"
}
```

## 🛠️ 技術要求

- **Python 版本**: 3.9+
- **推薦套件**: `requests`, `pandas`, `lxml`
- **必須支援**: 獨立執行測試

## 🧪 測試方式

```bash
python f01_fetcher_dev.py 2025-12-01
```

## ⚠️ 常見錯誤情況

| 情況 | 處理方式 |
|------|--------|
| 假日或無交易日 | 回傳 `狀態: "失敗"`, `錯誤: "該日無交易資料"` |
| TAIFEX 網頁改版 | 回傳 `狀態: "失敗"`, `錯誤: "無法找到預期欄位"` |
| 網路連線逾時 | 回傳 `狀態: "失敗"`, `錯誤: "連線逾時 (timeout)"` |

## ✅ 驗收標準

1. ✓ 程式能獨立執行，無額外依賴
2. ✓ 輸出格式符合上述 JSON 結構
3. ✓ 成功時至少有 `外資多單口數`, `外資空單口數`, `外資多空淨額`
4. ✓ 失敗時包含清晰的錯誤訊息
5. ✓ 程式能在 Python 3.9 環境執行

## ✅ 驗收流程

1. 交付 `f01_fetcher_dev.py` 至 `outsource/`
2. 由內部使用 `run_test.py` 驗收
3. 驗收通過後，移至 `fetchers/` 改名為 `f01_fetcher.py`
4. 納入正式執行流程，由 `run.py` 自動呼叫

---

📌 結論：  
這份 `f01_fetcher_dev_規範書` 是外包商的「唯一技術規範」





